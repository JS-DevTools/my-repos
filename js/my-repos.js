/*!
 * My Repos v0.2.0 (November 12th 2018)
 * 
 * https://myrepos.io/
 * 
 * @author  James Messinger (https://jamesmessinger.com)
 * @license MIT
 */
(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const config_1=require("./config"),util_1=require("./util");class ApiClient{async fetch(t,e){let[r]=await Promise.all([await fetchWithFallback(t,e),artificialDelay()]),a=await parseResponseBody(r);if(!r.ok)throw this.createError(`${getUrl(t)} returned an HTTP ${r.status} (${r.statusText||"Error"}) response`,a);return await cacheResponse(t,r),a}async fetchArray(t,e){let r=await this.fetch(t,e);if(!Array.isArray(r))throw this.createError(`${getUrl(t)} did not return a JSON array as expected`,r);return r}async fetchObject(t,e){let r=await this.fetch(t,e);if("object"!=typeof r)throw this.createError(`${getUrl(t)} did not return a JSON object as expected`,r);if(Array.isArray(r))throw this.createError(`${getUrl(t)} returned a JSON array, but a JSON object was expected`,r);return r}createError(t,e){return new Error(t+"\n"+JSON.stringify(e,void 0,2))}}async function fetchWithFallback(t,e){let r,a;util_1.LOCAL_DEV_MODE?(r=fetchFromCache,a=fetch):(r=fetch,a=fetchFromCache);let i=await r(t,e);return i.ok?i:a(t,e)}async function fetchFromCache(t){let e={status:503,statusText:"Service Unavailable",headers:{"Content-Type":"text/plain","Content-Length":"0"},body:""},r=localStorage.getItem(getUrl(t));if(r)try{e=JSON.parse(r)}catch(t){e.body=t.message}return new Response(e.body,e)}async function cacheResponse(t,e){let r={status:e.status,statusText:e.statusText,headers:util_1.mapToPOJO(e.headers),body:await e.clone().text()};localStorage.setItem(getUrl(t),JSON.stringify(r,void 0,2))}function getUrl(t){return"string"==typeof t?t:t.url}async function parseResponseBody(t){let e;try{e=await t.clone().text()}catch(t){return}try{let t=JSON.parse(e);return"object"==typeof t?t:String(t)}catch(t){return e}}async function artificialDelay(){let t=0;config_1.config.delay&&(t=util_1.random(0,config_1.config.delay)),await new Promise(e=>setTimeout(e,t))}exports.ApiClient=ApiClient},{"./config":11,"./util":17}],2:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const repo_list_1=require("../repo-list/repo-list");function AccountItem(e){let{account:t}=e;return React.createElement("section",{key:t.id,className:"account"},React.createElement("header",null,React.createElement("h1",null,React.createElement("a",{href:`https://github.com/${t.login}`},t.avatar_url&&React.createElement("img",{src:t.avatar_url,className:"avatar"}),t.name))),React.createElement(AccountItemContents,Object.assign({},e)))}function AccountItemContents(e){let{account:t,toggleRepo:a}=e;return t.repos.length>0?React.createElement(repo_list_1.RepoList,{account:t,toggleRepo:a}):t.error?React.createElement("div",{className:"error"},React.createElement("div",{className:"error-message"},t.error)):t.loading?React.createElement("div",{className:"loading"},React.createElement("div",{className:"loading-message"},"Loading...")):React.createElement("div",{className:"no-repos"},React.createElement("div",{className:"empty-message"},"There are no repos to show"))}exports.AccountItem=AccountItem},{"../repo-list/repo-list":10}],3:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const config_1=require("../../config"),util_1=require("../../util"),account_item_1=require("./account-item");function AccountList(t){let{accounts:e}=t;return React.createElement("main",{id:"account_list",className:util_1.accountCountCssClass(config_1.config.accounts)},React.createElement("div",{className:"responsive-container"},e.map(e=>React.createElement(account_item_1.AccountItem,Object.assign({account:e},t)))))}exports.AccountList=AccountList},{"../../config":11,"../../util":17,"./account-item":2}],4:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});class AddAccount extends React.Component{constructor(){super(...arguments),this.state={login:"",busy:!1},this.handleChange=(e=>{this.setState({login:e.target.value})}),this.handleSubmit=(async e=>{e.preventDefault(),this.state.login&&(this.setState({busy:!0}),await this.props.addAccount(this.state.login.trim()),this.setState({login:"",busy:!1}))})}render(){let{submitButtonText:e}=this.props,{login:t,busy:a}=this.state;return React.createElement("form",{className:`add-account form ${a?"busy":""}`,onSubmit:this.handleSubmit},React.createElement("dl",{className:"form-group"},React.createElement("dt",{className:"input-label"},React.createElement("label",{htmlFor:"repo_owner"},"GitHub Username")),React.createElement("dd",{className:"input-field"},React.createElement("input",{type:"text",name:"account_name",className:"form-control short",maxLength:100,autoFocus:!0,autoCapitalize:"off",autoComplete:"on",spellCheck:!1,placeholder:"GitHub Username",disabled:a,value:t,onChange:this.handleChange}))),React.createElement("button",{type:"submit",className:"btn btn-primary",disabled:a},e||"Add"))}}exports.AddAccount=AddAccount},{}],5:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const account_list_1=require("../account-list/account-list"),first_time_1=require("../first-time/first-time"),page_header_1=require("../page-header/page-header"),state_store_1=require("./state-store");class App extends React.Component{constructor(e){super(e),state_store_1.StateStore.mixin(this)}render(){return[React.createElement(page_header_1.PageHeader,{key:"page_header",addAccount:this.addAccount}),React.createElement(account_list_1.AccountList,Object.assign({key:"account_list",removeAccount:this.removeAccount,toggleRepo:this.toggleRepo},this.state)),React.createElement(first_time_1.FirstTime,{key:"first_time",addAccount:this.addAccount})]}}exports.App=App},{"../account-list/account-list":3,"../first-time/first-time":8,"../page-header/page-header":9,"./state-store":7}],6:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const github_1=require("../../github/github"),github_account_1=require("../../github/github-account");async function fetchGitHubAccount(t,e){let u,c=await Promise.all([safeResolve(github_1.github.fetchAccount(t)),safeResolve(github_1.github.fetchRepos(t))]),[{result:r,error:o},{result:i,error:n}]=c;u=o?new github_account_1.GitHubAccount({...t,error:o.message}):r&&n?new github_account_1.GitHubAccount({...r,error:n.message}):r&&i?new github_account_1.GitHubAccount({...r,repos:i}):t,e(t.id,u)}async function safeResolve(t){let e,u;try{e=await t}catch(t){u=t}return{result:e,error:u}}exports.fetchGitHubAccount=fetchGitHubAccount},{"../../github/github":14,"../../github/github-account":12}],7:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const config_1=require("../../config"),github_account_1=require("../../github/github-account"),hash_1=require("../../hash"),fetch_github_account_1=require("./fetch-github-account");class StateStore{constructor(){this.state={accounts:[]}}static mixin(t){let e=new StateStore;t.state=e.state,t.syncWithHash=e.syncWithHash.bind(t),t.addAccount=e.addAccount.bind(t),t.replaceAccount=e.replaceAccount.bind(t),t.removeAccount=e.removeAccount.bind(t),t.toggleRepo=e.toggleRepo.bind(t),setTimeout(t.syncWithHash,0),hash_1.hash.addEventListener("hashchange",t.syncWithHash)}syncWithHash(){let t=[];for(let e of config_1.config.accounts){let c=new github_account_1.GitHubAccount({login:e,name:e,loading:!0});fetch_github_account_1.fetchGitHubAccount(c,this.replaceAccount),t.push(c)}this.setState({accounts:t})}async addAccount(t){let e=this.state.accounts.find(byLogin(t));if(e)return;e=new github_account_1.GitHubAccount({login:t,name:t,loading:!0});let c=this.state.accounts.slice();c.push(e),this.setState({accounts:c}),await fetch_github_account_1.fetchGitHubAccount(e,this.replaceAccount)}replaceAccount(t,e){let c=this.state.accounts.slice();removeAccountByID(c,t),removeAccountByID(c,e.id),c.push(e);let o=[];for(let t of config_1.config.accounts){let e=c.findIndex(byLogin(t));if(e>=0){let[t]=c.splice(e,1);o.push(t)}}for(let t of c)o.push(t),config_1.config.addAccount(t),hash_1.hash.updateHash();this.setState({accounts:o})}removeAccount(t){let e=this.state.accounts.slice(),{removed:c}=removeAccountByID(e,t);c&&(this.setState({accounts:e}),config_1.config.removeAccount(c))}toggleRepo(t,e,c){let o=this.state.accounts.slice(),n=o.find(byID(t)),i=n.repos.find(byID(e));i.hidden=c,this.setState({accounts:o}),config_1.config.toggleRepo(n,i,c)}}function removeAccountByID(t,e){let c,o=t.findIndex(byID(e));return o>=0&&(c=t.splice(o,1)[0]),{index:o,removed:c}}function byID(t){return e=>e.id===t}function byLogin(t){return t=t.trim().toLowerCase(),e=>e.login.trim().toLowerCase()===t}exports.StateStore=StateStore},{"../../config":11,"../../github/github-account":12,"../../hash":15,"./fetch-github-account":6}],8:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const config_1=require("../../config"),util_1=require("../../util"),add_account_1=require("../add-account/add-account");function FirstTime(e){return React.createElement("aside",{id:"first_time",className:util_1.accountCountCssClass(config_1.config.accounts)},React.createElement("div",{className:"responsive-container"},React.createElement("div",{className:"welcome-message"},React.createElement("h3",null,"Hi! 👋 Enter your GitHub username to get started"),React.createElement(add_account_1.AddAccount,Object.assign({submitButtonText:"Show My Repos"},e)))))}exports.FirstTime=FirstTime},{"../../config":11,"../../util":17,"../add-account/add-account":4}],9:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const config_1=require("../../config"),util_1=require("../../util"),add_account_1=require("../add-account/add-account");function PageHeader(e){return React.createElement("header",{id:"page_header",className:util_1.accountCountCssClass(config_1.config.accounts)},React.createElement("div",{className:"responsive-container"},React.createElement("img",{className:"logo",src:"img/logo.png",alt:"logo image"}),React.createElement("h1",null,"My GitHub Repos"),React.createElement("h2",null,"All your GitHub repos on one page"),React.createElement(add_account_1.AddAccount,Object.assign({},e))))}exports.PageHeader=PageHeader},{"../../config":11,"../../util":17,"../add-account/add-account":4}],10:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const config_1=require("../../config");function RepoList(e){let{account:t,toggleRepo:c}=e,o=config_1.config.filterRepos(t.repos);return React.createElement("ul",{className:"repo-list"},o.map(t=>React.createElement(RepoItem,Object.assign({repo:t},e))))}function RepoItem(e){let{account:t,repo:c}=e;return React.createElement("li",{key:c.id,className:"repo"},React.createElement("h2",null,React.createElement("a",{href:`https://github.com/${t.login}/${c.name}`},c.name)),c.description&&React.createElement("h3",null,c.description))}exports.RepoList=RepoList},{"../../config":11}],11:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const util_1=require("./util");class Config{constructor(e={}){this.defaultDelay=util_1.LOCAL_DEV_MODE?1e3:0,this.accounts=e.accounts||new Set,this.hide=e.accounts||new Set,this.forks=e.forks||!1,this.delay=e.delay||this.defaultDelay}addAccount(e){this.accounts.add(e.login)}removeAccount(e){this.accounts.delete(e.login)}toggleRepo(e,t,i){i?this.hide.add(t.full_name):this.hide.delete(t.full_name)}filterRepos(e){return e.filter(e=>!e.isHidden(this))}}exports.Config=Config,exports.config=new Config},{"./util":17}],12:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});class GitHubAccount{constructor(t={}){this.id=t.id||Math.random(),this.login=t.login||"",this.name=t.name||"",this.avatar_url=t.avatar_url||"",this.bio=t.bio||"",this.repos=t.repos||[],this.loading=Boolean(t.loading),this.error=t.error}}exports.GitHubAccount=GitHubAccount},{}],13:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});class GitHubRepo{constructor(t){this.id=t.id||Math.random(),this.name=t.name||"",this.full_name=t.full_name||"",this.description=t.description||"",this.fork=t.fork||!1,this.stargazers_count=t.stargazers_count||0,this.hidden=t.hidden||!1}isHidden(t){return!!t.hide.has(this.full_name)||!(!this.fork||t.forks)}}exports.GitHubRepo=GitHubRepo},{}],14:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const api_client_1=require("../api-client"),github_account_1=require("./github-account"),github_repo_1=require("./github-repo");class GitHub{constructor(){this._client=new api_client_1.ApiClient}async fetchAccount(t){let i=await this._client.fetchObject(`https://api.github.com/users/${t.login}`);if(isGitHubAccountPOJO(i))return new github_account_1.GitHubAccount({...i,loading:!1,repos:[]});throw this._client.createError("Invalid GitHub account:",i)}async fetchRepos(t){let i=await this._client.fetchArray(`https://api.github.com/users/${t.login}/repos`);if(isArrayOfGitHubRepoPOJO(i)){let t=[];for(let e of i)t.push(new github_repo_1.GitHubRepo({...e,hidden:!1}));return t}throw this._client.createError("Invalid GitHub repo:",i)}}function isGitHubAccountPOJO(t){return"object"==typeof t&&"login"in t&&"string"==typeof t.login&&"name"in t&&"string"==typeof t.name&&"bio"in t&&"string"==typeof t.bio&&"avatar_url"in t&&"string"==typeof t.avatar_url}function isArrayOfGitHubRepoPOJO(t){return t.length>0&&"object"==typeof t[0]&&"string"==typeof t[0].name}exports.GitHub=GitHub,exports.github=new GitHub},{"../api-client":1,"./github-account":12,"./github-repo":13}],15:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const config_1=require("./config");class Hash extends EventTarget{constructor(){super(),this._handleHashChange(),window.addEventListener("hashchange",()=>this._handleHashChange())}updateHash(){location.hash=this.toString()}toString(){let e=new URLSearchParams;config_1.config.accounts.size>0&&e.append("u",[...config_1.config.accounts].join(",")),config_1.config.hide.size>0&&e.append("hide",[...config_1.config.hide].join(",")),config_1.config.forks&&e.append("forks","yes"),config_1.config.delay&&config_1.config.delay!==config_1.config.defaultDelay&&e.append("delay",String(config_1.config.delay));let n=e.toString();return n=(n=n.replace(/%2C/g,",")).replace(/%2F/g,"/")}_handleHashChange(){if(location.hash.substr(1)!==this.toString()){let e=new URLSearchParams(location.hash.substr(1));config_1.config.accounts=parseStringSet(e.get("u"),config_1.config.accounts),config_1.config.hide=parseStringSet(e.get("hide"),config_1.config.hide),config_1.config.forks=parseBoolean(e.get("forks"),config_1.config.forks),config_1.config.delay=parsePositiveInteger(e.get("delay"),config_1.config.delay),this.dispatchEvent(new Event("hashchange"))}}}function parseStringSet(e,n){if(n.clear(),e){let o=e.split(",");for(let e of o)(e=e.trim()).length>0&&n.add(e)}return n}function parseBoolean(e,n=!1){return e?["yes","true","on","ok","show"].includes(e.toLowerCase()):n}function parseNumber(e,n=0){let o=parseFloat(e);return isNaN(o)?n:o}function parseInteger(e,n=0){let o=parseNumber(e,n);return Number.isSafeInteger(o)?o:Math.round(o)}function parsePositiveInteger(e,n=0){let o=parseInteger(e,n);return o>=0?o:n}exports.Hash=Hash,exports.hash=new Hash},{"./config":11}],16:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const app_1=require("./components/app/app");ReactDOM.render(React.createElement(app_1.App,null),document.body)},{"./components/app/app":5}],17:[function(require,module,exports){"use strict";function mapToPOJO(t){let o={};for(let[s,a]of t.entries())o[s.toString()]=a;return o}function random(t,o){return t=Math.ceil(t),o=Math.floor(o),Math.floor(Math.random()*(o-t+1))+t}function accountCountCssClass(t){switch(t.size){case 0:return"no-accounts";case 1:return"has-accounts has-one-account";default:return"has-accounts has-multiple-accounts"}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.LOCAL_DEV_MODE="localhost"===location.hostname,exports.mapToPOJO=mapToPOJO,exports.random=random,exports.accountCountCssClass=accountCountCssClass},{}]},{},[16]);
//# sourceMappingURL=my-repos.js.map
//# sourceMappingURL=my-repos.js.map